---
title: 'TCP/IP协议详解'
date: 2020-06-05
categories:
 - 计算机网络
tags:
 - 计算机网络
---

**参考自[https://developer.51cto.com/art/201906/597961.htm](https://developer.51cto.com/art/201906/597961.htm)**

## 计算机网络体系结构分层
![](/img/network/network_01_img.jpg)


## TCP/IP基础
### 1. 具体含义
从字面意义上来看，TCP/IP似乎指的是TCP与IP两种协议，在实际生活中有时也确实就是指这两种协议。

然而在很多情况下，它只是利用 IP 进行通信时所必须用到的协议群的统称。

具体来说，IP 或 ICMP、TCP 或 UDP、TELNET 或 FTP、以及 HTTP 等都属于 TCP/IP 协议。
TCP/IP 一词泛指这些协议，因此，有时也称 TCP/IP 为网际协议群。

### 2. 数据处理流程
在数据传输过程中，每个分层都会在所发送的数据附加一个首部，首部中包含了发送的目标地址、协议信息等。
在首部中表明了协议应该如何读取数据。

下图以用户a向用户b发送邮件为例子：

![](/img/network/network_01_img_1.jpg)

## 传输层中的TCP与UDP
在TCP/IP中有两个具有代表性的传输层协议，分别是TCP与UDP。
- TCP提供的是面向连接的、可靠的数据流协议。TCP具有**重发控制**机制，因此能够提供可靠性传输。

- UDP提供的是不可靠性数据报协议。UDP采用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表。

### TCP——三次握手
所谓的三次握手是指建立一个TCP连接时需要客户端与服务端总共发送三个包，已确认建立连接。

用简单的话来描述就是：

第一次握手：主机A通过向主机B 发送一个含有同步序列号的标志位的数据段给主机B，向主机B 请求建立连接，通过这个数据段， 主机A告诉主机B 两件事：我想要和你通信；你可以用哪个序列号作为起始数据段来回应我。

第二次握手：主机B 收到主机A的请求后，用一个带有确认应答（ACK）和同步序列号（SYN）标志位的数据段响应主机A，也告诉主机A两件事：我已经收到你的请求了，你可以传输数据了；你要用那个序列号作为起始数据段来回应我

第三次握手：主机A收到这个数据段后，再发送一个确认应答，确认已收到主机B 的数据段："我已收到回复，我现在要开始传输实际数据了，这样3次握手就完成了，主机A和主机B 就可以传输数据了。

三次握手流程图：

![](/img/network/network_01_img_2.jpg)

### TCP——四次挥手
所谓的四次挥手即TCP连接的释放。连接的释放必须是一方主动释放，另一方被动释放。

举个通俗的例子来说就是：

"第一次挥手"：日久见人心，男孩发现女孩变成了自己讨厌的样子，忍无可忍，于是决定分手，随即写了一封信告诉女孩。

“第二次挥手”：女孩收到信之后，知道了男孩要和自己分手，怒火中烧，心中暗骂：你算什么东西，当初你可不是这个样子的！于是立马给男孩写了一封回信：分手就分手，给我点时间，我要把你的东西整理好，全部还给你！男孩收到女孩的第一封信之后，明白了女孩知道自己要和她分手。随后等待女孩把自己的东西收拾好。

“第三次挥手”：过了几天，女孩把男孩送的东西都整理好了，于是再次写信给男孩：你的东西我整理好了，快把它们拿走，从此你我恩断义绝！

“第四次挥手”：男孩收到女孩第二封信之后，知道了女孩收拾好东西了，可以正式分手了，于是再次写信告诉女孩：我知道了，这就去拿回来！

四次挥手流程图：

![](/img/network/network_01_img_3.jpeg)

### 为什么“握手”是三次，而“挥手”是四次
TCP建立连接时之所以只需要"三次握手"，是因为在第二次"握手"过程中，服务器端发送给客户端的TCP报文是以SYN与ACK作为标志位的。
SYN是请求连接标志，表示服务器端同意建立连接；ACK是确认报文，表示告诉客户端，服务器端收到了它的请求报文。

而TCP释放连接时之所以需要“四次挥手”,是因为FIN释放连接报文与ACK确认接收报文是分别由第二次和第三次"握手"传输的。

在释放连接时，被动方服务器图然收到主动方客户端释放连接的请求时并不能立即释放连接，因为还有必要的数据需要处理，就像当男朋友跟你提分手时，
你还需要将他的东西整理好~~还给他~~扔掉，才能真正地跟他恩断义绝。